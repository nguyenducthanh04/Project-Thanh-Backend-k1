<h4 style="text-align: center">Danh sách quản trị viên</h4>
<form action="/deleteAllStudents" method="POST" style="margin-bottom: 14px">
  <input type="hidden" id="listDelete" name="listUserDelete" value="" />
  <button type="submit" class="btn btn-danger" id="deleteAll">
    Xóa tất cả
  </button>
</form>
<form action="" class="mb-2">
  <div class="row">
    <div class="col-3 mb-2">
      <select name="typeId" class="form-select">
        <option value="all">Tất cả</option>
        <option value="admin">Admin</option>
        <option value="teacher">Giảng viên</option>
        <option value="student">Học viên</option>
      </select>
    </div>
    <div class="col-10">
      <input
        type="search"
        name="keyword"
        class="form-control"
        value="<%= req.query.keyword %>"
        placeholder="Từ khóa tìm kiếm"
      />
    </div>
    <div class="col-2">
      <button type="submit" class="btn btn-primary">
        <i class="fas fa-search"></i>
      </button>
      <a href="/exportAdmin" class="btn btn-success"
        >Export file excel <i class="fas fa-file-excel"></i
      ></a>
    </div>
  </div>
</form>
<table class="table table-bordered">
  <thead>
    <tr>
      <th><input id="checkboxAll" type="checkbox" /></th>
      <th width="5%">STT</th>
      <th>Tên</th>
      <th>Email</th>
      <th>Phone</th>
      <th>Address</th>
      <th width="10%">Chức vụ</th>
      <th>Sửa</th>
      <th>Xóa</th>
    </tr>
  </thead>
  <tbody>
    <% userList.forEach((user, index) => { %>
    <tr>
      <td>
        <input class="checkboxItem" type="checkbox" value="<%= user.id %>" />
      </td>
      <td><%= index + 1 %></td>
      <td><%= user.name %></td>
      <td><%= user.email %></td>
      <td><%= user.phone %></td>
      <td><%= user.address %></td>
      <% if(user.typeId === 1) { %>
      <td>Admin</td>
      <% } else if(user.typeId === 2) { %>
      <td>Giảng viên</td>
      <% } else { %>
      <td>Học viên</td>
      <% } %>
      <td>
        <a href="/editUser/<%= user.id %>"
          ><i class="far fa-edit" style="font-size: 1.2rem"></i
        ></a>
      </td>
      <td>
        <form
          action="/deleteUser/<%= user.id %>"
          onsubmit="return confirm('Bạn có chắc chắn muốn xóa người dùng ?')"
          method="post"
        >
          <button class="btn btn-sm">
            <i class="fas fa-trash-alt" style="font-size: 1.2rem"></i>
          </button>
        </form>
      </td>
    </tr>
    <% }) %>
  </tbody>
</table>
<% if(totalPage >= 2) { %>
<nav class="d-flex justify-content-end mt-4">
  <ul class="pagination">
    <% if(page > 1) { %>
    <li class="page-item">
      <a href="?page=<%= +page-1 %>" class="page-link">Trước</a>
    </li>
    <% } %> <% pagination.forEach(pageItem => { %>
    <li class="page-item <%= +page === +pageItem ? 'active': ''%>">
      <a href="?<%= getUrl(req, pageItem) %>" class="page-link"
        ><%= pageItem %></a
      >
    </li>
    <% }); %> <% if(page < totalPage) { %>
    <li class="page-item">
      <a href="?page=<%= +page+1 %>" class="page-link">Sau</a>
    </li>
    <% } %>
  </ul>
</nav>
<% } %>

<script>
  const checkboxAll = document.querySelector("#checkboxAll");
  const inputDelete = document.querySelector("#listDelete");
  const checkboxCourses = document.querySelectorAll(".checkboxItem");
  const deleteAllBtn = document.querySelector("#deleteAll");
  let arr = [];

  checkboxAll.addEventListener("change", function (e) {
    const haveChecked = Array.from(checkboxCourses).some(
      (checkboxCourse) => checkboxCourse.checked
    );

    if (haveChecked) {
      e.target.checked = false;
      checkboxCourses.forEach((checkboxCourse) => {
        checkboxCourse.checked = false;
      });
      arr = [];
      inputDelete.value = "";
    }

    if (e.target.checked) {
      checkboxCourses.forEach((checkboxCourse) => {
        checkboxCourse.checked = true;
        arr.push(checkboxCourse.value);
      });
      inputDelete.value = arr.toString();
      return;
    }
    checkboxCourses.forEach((checkboxCourse) => {
      checkboxCourse.checked = false;
      arr = [];
    });
    inputDelete.value = "";
  });

  checkboxCourses.forEach((checkboxCourse) => {
    checkboxCourse.addEventListener("change", function (e) {
      if (!e.target.checked) {
        checkboxAll.checked = false;
        arr = arr.filter((val) => val !== e.target.value);
        inputDelete.value = arr.toString();
        return;
      }
      arr.push(e.target.value);
      inputDelete.value = arr.toString();
      checkboxAll.checked = Array.from(checkboxCourses).every(
        (checkboxCourse) => checkboxCourse.checked
      );
    });
  });

  deleteAllBtn.onclick = () => {
    arr = [...new Set(arr)];
    console.log(arr.toString());
  };
</script>
